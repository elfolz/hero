var e,t={245:(e,t,i)=>{const s={get name(){return/(iphone)/i.test(navigator.userAgent)?"iphone":/(ipad)/i.test(navigator.userAgent)?"ipad":/(android)/i.test(navigator.userAgent)?"android":/(windows)/i.test(navigator.userAgent)?"windows":/(linux|arch|ubuntu|mint|manjaro|debian)/i.test(navigator.userAgent)?"linux":/(mac|macos|macintosh)/i.test(navigator.userAgent)?"mac":null},get osVersion(){return/(iphone)/i.test(navigator.userAgent)?parseInt(/OS\s(\d+)_(\d+)_?(\d+)?/i.exec(navigator.userAgent)[1]||"0"):parseInt(/(?:linux|arch|ubuntu|mint|manjaro|debian|windows|android|mac)\s([\.\_\d]+)/i.exec(navigator.userAgent)[1]||"0")},get memory(){return navigator.deviceMemory??0},get cpuCores(){return navigator.hardwareConcurrency??0},get isMobile(){return/(iphone|ipad|android)/i.test(navigator.userAgent)},get isPC(){return!/(iphone|ipad|android)/i.test(navigator.userAgent)},get isApple(){return/(iphone|ipad|mac)/i.test(navigator.userAgent)},get isLocalhost(){return["127.0.0.1","localhost"].includes(location.hostname)}};var n;function o(){document.hidden||"wakeLock"in navigator&&navigator.wakeLock.request("screen").then((e=>n=e))}window.menuConfigOpened=function(){return document.querySelector("#menu-config").classList.contains("opened")},window.toggleMenuConfig=function(e=!1){const t=document.querySelector("#menu-config");t.classList.toggle("opened"),t.classList.contains("opened")?window.sound.playClick():window.sound.playCancel(),e&&t.classList.contains("opened")?t.firstChild.classList.add("active"):t.childNodes.forEach((e=>e.classList.remove("active")))},window.navigateMenuConfig=function(e){const t=Array.from(document.querySelector("#menu-config").childNodes).filter((e=>!e.classList.contains("off"))),i=t.findIndex((e=>e.classList.contains("active")));let s;e>0&&i<t.length-1?s=i+1:e<0&&i>0&&(s=i-1),s>=0&&(window.sound.playCursor(),document.querySelector("#menu-config").childNodes.forEach((e=>e.classList.remove("active"))),t[s].classList.add("active"))},window.executeMenuConfig=function(e){if(e||(e=Array.from(document.querySelector("#menu-config").childNodes).find((e=>e.classList.contains("active"))).id),e.includes("music-on"))localStorage.setItem("bgm","true"),document.querySelector("#menu-button-music-on").classList.add("off"),document.querySelector("#menu-button-music-off").classList.remove("off"),document.querySelector("#menu-config").childNodes.forEach((e=>e.classList.remove("active"))),document.querySelector("#menu-config").childNodes[1].classList.add("active"),window.sound.playBGM();else if(e.includes("music-off"))localStorage.setItem("bgm","false"),document.querySelector("#menu-button-music-off").classList.add("off"),document.querySelector("#menu-button-music-on").classList.remove("off"),document.querySelector("#menu-config").childNodes.forEach((e=>e.classList.remove("active"))),document.querySelector("#menu-config").childNodes[0].classList.add("active"),window.sound.stopBGM();else if(e.includes("controls")){let e=document.querySelector("#dialog-controller");e.classList.toggle("opened"),e.classList.contains("opened")?window.sound.playClick():window.sound.playCancel()}else e.includes("fps")?(localStorage.getItem("fpsLimit")&&"0"!=localStorage.getItem("fpsLimit")?"60"==localStorage.getItem("fpsLimit")?window.refreshFPS(30):"30"==localStorage.getItem("fpsLimit")&&window.refreshFPS(0):window.refreshFPS(60),window.game.refreshFPS(!1)):e.includes("resolution")?(localStorage.getItem("resolution")&&"0"!=localStorage.getItem("resolution")?"1"==localStorage.getItem("resolution")?window.refreshResolution(2):"2"==localStorage.getItem("resolution")&&window.refreshResolution(0):window.refreshResolution(1),window.game.refreshResolution(!1),window.game.resizeScene()):e.includes("pixel_density")?(localStorage.getItem("pixelDensity")&&"0"!=localStorage.getItem("pixelDensity")?"1"==localStorage.getItem("pixelDensity")?window.refreshPixelDensity(2):"2"==localStorage.getItem("pixelDensity")&&window.refreshPixelDensity(0):window.refreshPixelDensity(1),window.game.refreshPixelDensity(),window.game.resizeScene()):e.includes("antialiasing")?("true"==localStorage.getItem("antialiasing")?window.refreshAntialiasing(!1):window.refreshAntialiasing(!0),window.game.refreshAntialiasing(!1)):e.includes("force_refresh")&&caches.delete("hero").then((()=>location.reload(!0)))},window.refreshFPS=function(e,t=!0){t&&("number"==typeof e?localStorage.setItem("fpsLimit",e.toString()):localStorage.removeItem("fpsLimit")),document.querySelector("#menu-button-fps label").innerHTML=`${e>0?e:"Auto"} FPS`},window.refreshResolution=function(e,t=!0){t&&("number"==typeof e?localStorage.setItem("resolution",e):localStorage.removeItem("resolution"));let i=(1==e?"Medium":2==e?"Low":"High")+" resolution";document.querySelector("#menu-button-resolution label").innerHTML=i},window.refreshPixelDensity=function(e,t=!0){t&&("number"==typeof e?localStorage.setItem("pixelDensity",e.toString()):localStorage.removeItem("pixelDensity"));let i=(1==e?"Medium":2==e?"Low":"High")+" pixel density";document.querySelector("#menu-button-pixel_density label").innerHTML=i},window.refreshAntialiasing=function(e,t=!0){t&&("boolean"==typeof e?localStorage.setItem("antialiasing",e.toString()):localStorage.removeItem("antialiasing"));let i="Antialiasing "+(e?"on":"off");document.querySelector("#menu-button-antialiasing label").innerHTML=i,e?(document.querySelector("#antialiasing-on").style.removeProperty("display"),document.querySelector("#antialiasing-off").style.setProperty("display","none")):(document.querySelector("#antialiasing-on").style.setProperty("display","none"),document.querySelector("#antialiasing-off").style.removeProperty("display"))},window.refreshControlsMenu=()=>{window.game?.player?.gamepadConnected||s.isPC?document.querySelector("#menu-button-controls").style.removeProperty("display"):document.querySelector("#menu-button-controls").style.setProperty("display","none"),window.game?.player?.gamepadConnected?(document.querySelectorAll("#gamepad")?.forEach((e=>e.style.removeProperty("display"))),document.querySelectorAll("#keyboard")?.forEach((e=>e.style.setProperty("display","none")))):(document.querySelectorAll("#gamepad")?.forEach((e=>e.style.setProperty("display","none"))),document.querySelectorAll("#keyboard")?.forEach((e=>e.style.removeProperty("display"))))},window.setFullscreen=()=>{navigator.standalone||document.fullscreenElement||s.isPC||s.isLocalhost||!1 in document.documentElement||document.documentElement.requestFullscreen({navigationUI:"hide"}).then((()=>screen.orientation.lock("landscape"))).catch((e=>{}))},document.onclick=()=>{window.menuConfigOpened()&&(document.querySelector("#menu-config").classList.remove("opened"),window.sound.playCancel())},document.onvisibilitychange=()=>{window.game?.toggleVisibility(),window.sound?.toggleVisibility(),document.hidden?(document.querySelectorAll("footer section button").forEach((e=>{e.classList.remove("active")})),n&&n.release()):o()},document.onreadystatechange=()=>{"complete"==document.readyState&&(document.querySelector("#loading button").onclick=()=>{window.sound.playClick(),window.game.initGame()},"false"==localStorage.getItem("bgm")&&(document.querySelector("#menu-button-music-on").classList.remove("off"),document.querySelector("#menu-button-music-off").classList.add("off")),document.querySelector("#button-config").onclick=e=>{e.stopPropagation(),window.toggleMenuConfig()},document.querySelector("#menu-button-music-off").onclick=e=>{e.stopPropagation(),window.executeMenuConfig("music-off")},document.querySelector("#menu-button-music-on").onclick=e=>{e.stopPropagation(),window.executeMenuConfig("music-on")},document.querySelector("#menu-button-controls").onclick=e=>{window.executeMenuConfig("controls")},document.querySelector("#dialog-controller button").onclick=e=>{document.querySelector("#dialog-controller").classList.remove("opened")},document.querySelector("#menu-button-fps").onclick=e=>{e.stopPropagation(),window.executeMenuConfig("fps")},document.querySelector("#menu-button-resolution").onclick=e=>{e.stopPropagation(),window.executeMenuConfig("resolution")},document.querySelector("#menu-button-pixel_density").onclick=e=>{e.stopPropagation(),window.executeMenuConfig("pixel_density")},document.querySelector("#menu-button-antialiasing").onclick=e=>{e.stopPropagation(),window.executeMenuConfig("antialiasing")},document.querySelector("#menu-button-force_refresh").onclick=e=>{e.stopPropagation(),window.executeMenuConfig("force_refresh")},window.refreshControlsMenu())},window.oncontextmenu=e=>(e.preventDefault(),!1),window.onresize=()=>{window.game?.refreshResolution(!1,!0)},"screen"in window&&(screen.orientation.onchange=()=>{window.game?.refreshResolution(!1,!0)}),document.addEventListener("click",(()=>{window.setFullscreen(),window.sound.init()}),{once:!0}),o();var a=i(477);var r=i(217),c=i(515),h=i(357);function l(e,t,i=!0){let s=Math.random()*(t-e+1)+e;return i?Math.floor(s):s}class d{constructor(e,t){this.callback=e,this.onload=t,this.gltfLoader=new r.E,this.fbxLoader=new c.y,this.textureLoader=new a.dpR,this.caster=new a.iMs,this.vertex=new a.Pa4,this.position=new a.Pa4,this.scale=new a.Pa4,this.roration=new a.Pa4,this.box1=new a.ZzF,this.box2=new a.ZzF,this.progress=[],this.animations=[],this.audios={},this.pendingSounds=[],this.hitbox={},this.setupLoading(),this.loadModel(),this.setupDecalMaterial()}setupLoading(){if(!this.onload)return;const e=this;this.progress=new Proxy({},{set:function(t,i,s){t[i]=s;let n=Object.values(t).slice().reduce(((e,t)=>e+t),0);return n/=e.loadingElements,e.onload(n),!0}})}setupDecalMaterial(){this.decalMaterial=new a.xoR({specular:4473924,shininess:30,color:16711680,map:this.textureLoader.load("/textures/decal-diffuse.png"),normalMap:this.textureLoader.load("/textures/decal-normal.jpg"),transparent:!0,depthTest:!0,depthWrite:!1,polygonOffset:!0,polygonOffsetFactor:-4,wireframe:!1})}update(e){this.dead||(window.game.pause||this.mixer?.update(e),this.object&&this.updateActions())}executeCrossFade(e,t=.25,i="repeat"){if(this.lastAction&&e&&(!this.died||"die"==e.name)){if(this.lastAction==e)return e.reset();e.enabled=!0,e.setEffectiveTimeScale(1),e.setEffectiveWeight(1),e.loop="pingpong"==i?a.uEv:"once"==i?a.jAl:a.YKA,e.clampWhenFinished="once"==i,"once"==i&&e.reset(),this.lastAction.crossFadeTo(e,t,!0),this.lastAction=e,e.play()}}synchronizeCrossFade(e,t=.25,i="repeat"){this.mixer.addEventListener("finished",(function n(o){s.mixer.removeEventListener("finished",n),s.executeCrossFade(e,t,i)}));const s=this}updateObjectFollow(e,t,i){!i&&this.movingSpeed?i=this.movingSpeed:i||(i=.01);const s=Math.min(60*i/window.game.fps,i),n=e.object.position.clone(),o=this.object.position.clone().sub(n).multiplyScalar(t?s:-1*s);this.object.lookAt(n),this.object.position.add(o)}getDistance(e){if(!this.hitbox[0]||!e.hitbox[0])return;if(this.lastCollisionUpdate>performance.now()-500)return;this.lastCollisionUpdate=performance.now();let t=this.hitbox[0].geometry.attributes.position;for(let i=0;i<t.count;i++){let s=this.vertex.fromBufferAttribute(t,i).applyMatrix4(this.object.matrix).sub(this.object.position);this.caster.set(this.object.position,s.normalize());let n=this.caster.intersectObjects([e.hitbox[0]]),o=n.length>0&&n[0].distance<s.length();if(n.length>0)return{distance:n[0].distance,collided:o}}}hasHit(e,t="weapon"){if(this[t]&&e.hitbox[1])return this[t].updateMatrixWorld(!0),e.hitbox[1].updateMatrixWorld(!0),this.box1.copy(this[t].geometry.boundingBox),this.box1.applyMatrix4(this[t].matrixWorld),this.box2.copy(e.hitbox[1].geometry.boundingBox),this.box2.applyMatrix4(e.hitbox[1].matrixWorld),this.box1.intersectsBox(this.box2)}async fetchAudio(e,t,i=!1,s=10,n=100){if(window.sound?.audioContext)try{let o=await fetch(t,{cache:"force-cache"}),a=await o.arrayBuffer(),r=await window.sound.audioContext.decodeAudioData(a);this.audios[e]=r,i&&this.setPositionalAudio(e,r,s,n)}catch(e){}}setPositionalAudio(e,t,i=10,s=100){if(!window.sound?.audioListener)return;const n=new a.VYz(window.sound?.audioListener);n.name=e,n.setBuffer(t),n.setRefDistance(i),n.setMaxDistance(s),n.onEnded=()=>{n.stop(),this.se=void 0},this.object?this.object.add(n):this.pendingSounds.push(n)}setupBlood(){if(!this.hitbox[1])return;this.position=this.hitbox[1].position.clone(),this.roration.z=2*Math.random()*Math.PI;let e=l(3,5,!1);this.scale.set(e,e,e);const t=new h.k(this.hitbox[1],this.position,this.roration,this.scale),i=new a.Kj0(t,this.decalMaterial);i.receiveShadow=!0,window.game.scene.add(i)}loadModel(){}initAudio(){}updateActions(){}resizeScene(){}toggleVisibility(){}setupDamage(e){}}class u extends d{movingSpeed=.005;animationModels=["idle","walk","attack","hit","die"];constructor(e,t,i){super(t,i),this.loadingElements=this.animationModels.length+1,this.player=e,this.hp=100,this.maxhp=100}loadModel(){fetch("./models/humanoid/humanoid.glb",{cache:"force-cache"}).then((e=>e.arrayBuffer())).then((e=>{this.gltfLoader.parse(e,null,(e=>{this.object=e.scene,this.object.colorSpace=a.KI_,this.object.traverse((e=>{e.isMesh&&(e.castShadow=!0)})),this.object.position.set(0,0,20),this.object.lookAt(0,0,-1),this.mixer=new a.Xcj(this.object),this.hitbox[0]=new a.Kj0(new a.xo$(1.1),new a.vBJ({visible:window.debugging,color:65280})),this.object.add(this.hitbox[0]),this.hitbox[0].geometry.computeBoundingBox(),this.hitbox[1]=new a.Kj0(new a.DvJ(1.1,1.1,3.2),new a.vBJ({visible:window.debugging,color:16711680})),this.hitbox[1].position.z-=5.4,this.object.add(this.hitbox[1]),this.object.getObjectByName("mixamorigSpine1").attach(this.hitbox[1]),this.hitbox[1].geometry.computeBoundingBox(),this.weapon=new a.Kj0(new a.xo$(.35),new a.vBJ({visible:!1})),this.weapon.name="weapon",this.weapon.position.set(this.object.position.x+3.7,this.object.position.y-.3,this.object.position.z+6.5),this.object.getObjectByName("mixamorigRightHand").attach(this.weapon),this.weapon.geometry.computeBoundingBox(),this.onFinishActions(),this.loadAnimations(),this.callback(this.object),this.pendingSounds.forEach((e=>this.object.add(e))),this.pendingSounds.splice(0),this.progress.foe=100}),(e=>{e.total&&(this.progress.foe=e.loaded/e.total*99)}),(e=>{console.error(e)}))})).catch((e=>{console.log(e)}))}loadAnimations(){this.animationModels.forEach((e=>{fetch(`./models/humanoid/${e}.fbx`,{cache:"force-cache"}).then((e=>e.arrayBuffer())).then((t=>{const i=this.fbxLoader.parse(t);this.animations[e]=this.mixer.clipAction(i.animations[0]),this.animations[e].name=e,"idle"==e&&(this.lastAction=this.animations[e],this.animations[e].play()),this.progress[e]=100})).catch((e=>{console.log(e)}))}))}update(e){super.update(e),this.processingAttack&&this.executeMelleeAttack()}updateActions(){if(location.search.includes("stop-enemy"))return;if(this.isAttacking||this.beenHit||this.died)return;let e=this.getDistance(this.player);if(e?.distance<=3.5&&!this.isAttacking){this.isAttacking=!0,this.waitForAnimation=!0;let e=.1;this.executeCrossFade(this.animations.attack,e,"once"),setTimeout((()=>this.executeMelleeAttack()),window.game.delay*(1e3*e*4/3))}if(!this.waitForAnimation){if(this.isWalking){if(!this.se){let e=this.object.children.filter((e=>"Audio"==e.type));if(!e.length)return;let t=l(0,e.length-1);e[t]&&!e[t].isPlaying&&(e[t].play(),this.se=e[t])}this.updateObjectFollow(this.player,e?.collided)}e?.distance<200&&!this.isWalking?(this.isWalking=!0,this.executeCrossFade(this.animations.walk)):e?.distance&&this.isWalking&&(this.isWalking=!1,this.synchronizeCrossFade(this.animations.idle))}}onFinishActions(){this.mixer.addEventListener("finished",(()=>{this.waitForAnimation=!1,this.isAttacking=!1,this.processingAttack=!1,this.beenHit=!1,this.executeCrossFade(this.returnAction)}))}initAudio(){for(let e=0;e<9;e++)this.fetchAudio(`attack-${e}`,`./audio/monster/homanoid-${e}.mp3`,!0)}executeMelleeAttack(){if(!this.isAttacking)return;let e=this.hasHit(this.player);e&&Math.random()<=.75&&this.player.setupDamage(10),this.processingAttack=!e}setupDamage(e){if(this.hp-=e,this.hp<0&&(this.hp=0),this.waitForAnimation=!0,this.beenHit=!0,this.executeCrossFade(this.animations.hit,.1,"once"),this.hp<=0&&!this.died){let e=this.object.children.find((e=>"attack-8"==e.name));e.play(),this.se=e,this.executeCrossFade(this.animations.die,1,"once"),this.died=!0}}get returnAction(){return this.isWalking?this.animations.walk:this.animations.idle}}const g={gamepad:{default:{UP:12,LEFT:14,RIGHT:15,DOWN:13,X:2,Y:3,A:0,B:1,RB:5,RT:7,LB:4,LT:6,MENU:9,OPT:8,XAxes:0,YAxes:1},2563:{UP:null,LEFT:null,RIGHT:null,DOWN:null,X:3,Y:0,A:2,B:1,RB:5,RT:7,LB:4,LT:6,MENU:9,OPT:8,XAxes:0,YAxes:1}},keyboard:{keyPause:27,keySlash:13,keyKick:75,keyWalk:87,keyJump:74,keyTurnLeft:65,keyTurnRight:68,keyStepBack:83,keyRoll:82,keyBackflip:76,keyHeal:72}};class p extends d{animationModels=["idle","running","walkingBack","jumping","jumpingRunning","backflip","kick","rolling","outwardSlash","inwardSlash","stomachHit","dieing","drinking","walking"];constructor(e,t,i){super(t,i),this.loadingElements=this.animationModels.length+2,this.camera=e,this.actions=[],this.keysPressed={},this.potions=3,this.hp=100,this.maxhp=100,this.initControls()}update(e){super.update(e),this.gamepadConnected&&this.updateGamepad(),this.processingAttack&&this.executeMelleeAttack()}loadModel(){fetch("./models/hero/hero.glb",{cache:"force-cache"}).then((e=>e.arrayBuffer())).then((e=>{this.gltfLoader.parse(e,null,(e=>{this.object=e.scene,this.object.colorSpace=a.KI_,this.object.traverse((e=>{e.isMesh&&(e.castShadow=!0)})),this.camera.position.set(this.object.position.x,this.object.position.y+6.65,this.object.position.z-20),this.camera.lookAt(0,6.65,0),this.object.add(this.camera),this.mixer=new a.Xcj(this.object),this.hitbox[0]=new a.Kj0(new a.xo$(1.1),new a.vBJ({visible:window.debugging,color:65280})),this.object.add(this.hitbox[0]),this.hitbox[0].geometry.computeBoundingBox(),this.hitbox[1]=new a.Kj0(new a.DvJ(1.1,1.1,3),new a.vBJ({visible:window.debugging,color:16711680})),this.hitbox[1].position.z-=4.6,this.object.add(this.hitbox[1]),this.object.getObjectByName("mixamorigSpine1").attach(this.hitbox[1]),this.hitbox[1].geometry.computeBoundingBox(),this.onFinishActions(),this.loadWeapon(),this.callback(this.object),this.progress.player=100}),(e=>{e.total&&(this.progress.player=e.loaded/e.total*99)}),(e=>{console.error(e)}))})).catch((e=>{console.log(e)}))}loadWeapon(){fetch("./models/equips/sword.glb",{cache:"force-cache"}).then((e=>e.arrayBuffer())).then((e=>{this.gltfLoader.parse(e,null,(e=>{this.sword=e.scene,this.sword.colorSpace=a.KI_,this.sword.traverse((e=>{e.isMesh&&(e.castShadow=!0,this.weapon||(this.weapon=e))})),this.weapon.geometry.computeBoundingBox(),this.sword.rotation.y=Math.PI/6,this.sword.position.set(this.object.position.x-2.6,this.object.position.y+.6,this.object.position.z-4),this.object.getObjectByName("mixamorigRightHand").attach(this.sword),this.progress.sword=100,this.loadAnimations()}),(e=>{e.total&&(this.progress.sword=e.loaded/e.total*99)}),(e=>{console.error(e)}))})).catch((e=>{console.log(e)}))}loadAnimations(){this.animationModels.forEach((e=>{fetch(`./models/hero/${e}.fbx`,{cache:"force-cache"}).then((e=>e.arrayBuffer())).then((t=>{const i=this.fbxLoader.parse(t);this.animations[e]=this.mixer.clipAction(i.animations[0]),this.animations[e].name=e,this.progress[e]=100,"idle"==e&&(this.lastAction=this.animations.idle,this.animations.idle.play())})).catch((e=>{console.log(e)}))}))}initControls(){window.addEventListener("gamepadconnected",(e=>{this.gamepadConnected=!0;let t="default",i=/vendor:\s(\w+)\sproduct:\s(\w+)/i.exec(e.gamepad.id);i&&(t=i[1]),this.gamepadSettings=g.gamepad[t]??g.gamepad.default,window.refreshControlsMenu()})),window.addEventListener("gamepaddisconnected",(e=>{this.gamepadConnected=!1,window.refreshControlsMenu()})),window.onkeydown=e=>{this.keysPressed[e.keyCode]=!0,this.keysPressed[g.keyboard.keySlash]&&!this.actions.includes("slash")&&this.actions.push("slash"),this.keysPressed[g.keyboard.keyTurnLeft]&&!this.actions.includes("turningLeft")&&this.actions.push("turningLeft"),this.keysPressed[g.keyboard.keyTurnRight]&&!this.actions.includes("turningRight")&&this.actions.push("turningRight"),this.keysPressed[g.keyboard.keyWalk]&&!this.actions.includes("walking")&&this.actions.push("walking"),this.keysPressed[g.keyboard.keyBackflip]&&!this.actions.includes("backflip")&&this.actions.push("backflip"),this.keysPressed[g.keyboard.keyStepBack]&&!this.actions.includes("walkingBack")&&this.actions.push("walkingBack"),this.keysPressed[g.keyboard.keyJump]&&!this.actions.includes("jumping")&&this.actions.push("jumping"),this.keysPressed[g.keyboard.keyKick]&&!this.actions.includes("kick")&&this.actions.push("kick"),this.keysPressed[g.keyboard.keyRoll]&&!this.actions.includes("rolling")&&this.actions.push("rolling"),this.keysPressed[g.keyboard.keyHeal]&&!this.actions.includes("drinking")&&this.actions.push("drinking"),this.keysPressed[g.keyboard.keyPause]&&window.game.togglePause()},window.onkeyup=e=>{this.keysPressed[e.keyCode]=!1,e.keyCode==g.keyboard.keySlash&&this.actions.splice(this.actions.findIndex((e=>"slash"==e)),1),e.keyCode==g.keyboard.keyTurnLeft&&this.actions.splice(this.actions.findIndex((e=>"turningLeft"==e)),1),e.keyCode==g.keyboard.keyTurnRight&&this.actions.splice(this.actions.findIndex((e=>"turningRight"==e)),1),e.keyCode==g.keyboard.keyWalk&&this.actions.splice(this.actions.findIndex((e=>"walking"==e)),1),e.keyCode==g.keyboard.keyBackflip&&this.actions.splice(this.actions.findIndex((e=>"backflip"==e)),1),e.keyCode==g.keyboard.keyStepBack&&this.actions.splice(this.actions.findIndex((e=>"walkingBack"==e)),1),e.keyCode==g.keyboard.keyJump&&this.actions.splice(this.actions.findIndex((e=>"jumping"==e)),1),e.keyCode==g.keyboard.keyKick&&this.actions.splice(this.actions.findIndex((e=>"kick"==e)),1),e.keyCode==g.keyboard.keyRoll&&this.actions.splice(this.actions.findIndex((e=>"rolling"==e)),1),e.keyCode==g.keyboard.keyHeal&&this.actions.splice(this.actions.findIndex((e=>"drinking"==e)),1)};const e=document.querySelector("#button-forward");e.ontouchstart=t=>{this.actions.includes("walking")||this.actions.push("walking"),e.classList.add("active")},e.ontouchmove=t=>{if(t.cancelable&&(t.preventDefault(),t.stopPropagation()),!e.posX&&e.getClientRects()&&(e.posX=e.getClientRects()[0].x),t.changedTouches[0].pageX<e.posX){if(this.actions.includes("turningLeft"))return;this.actions.push("turningLeft"),document.querySelector("#button-left").classList.add("active")}else this.actions.includes("turningLeft")&&(this.actions.splice(this.actions.findIndex((e=>"turningLeft"==e)),1),document.querySelector("#button-left").classList.remove("active"));if(t.changedTouches[0].pageX>e.posX+64){if(this.actions.includes("turningRight"))return;this.actions.push("turningRight"),document.querySelector("#button-right").classList.add("active")}else this.actions.includes("turningRight")&&(this.actions.splice(this.actions.findIndex((e=>"turningRight"==e)),1),document.querySelector("#button-right").classList.remove("active"))},e.ontouchend=t=>{this.actions.splice(this.actions.findIndex((e=>"walking"==e)),1),this.actions.includes("turningLeft")&&this.actions.splice(this.actions.findIndex((e=>"turningLeft"==e)),1),this.actions.includes("turningRight")&&this.actions.splice(this.actions.findIndex((e=>"turningRight"==e)),1),e.classList.remove("active"),document.querySelector("#button-left").classList.remove("active"),document.querySelector("#button-right").classList.remove("active")},document.querySelector("#button-backward").ontouchstart=e=>{this.actions.includes("walkingBack")||this.actions.push("walkingBack")},document.querySelector("#button-backward").ontouchend=e=>{this.actions.splice(this.actions.findIndex((e=>"walkingBack"==e)),1)},document.querySelector("#button-left").ontouchstart=e=>{this.actions.includes("turningLeft")||this.actions.push("turningLeft")},document.querySelector("#button-left").ontouchend=e=>{this.actions.splice(this.actions.findIndex((e=>"turningLeft"==e)),1)},document.querySelector("#button-right").ontouchstart=e=>{this.actions.includes("turningRight")||this.actions.push("turningRight")},document.querySelector("#button-right").ontouchend=e=>{this.actions.splice(this.actions.findIndex((e=>"turningRight"==e)),1)},document.querySelector("#button-attack").ontouchstart=e=>{this.actions.includes("slash")||this.actions.push("slash")},document.querySelector("#button-attack").ontouchend=e=>{this.actions.splice(this.actions.findIndex((e=>"slash"==e)),1)},document.querySelector("#button-heal").ontouchstart=e=>{this.actions.includes("drinking")||this.actions.push("drinking")},document.querySelector("#button-heal").ontouchend=e=>{this.actions.splice(this.actions.findIndex((e=>"drinking"==e)),1)},document.querySelector("#button-roll").ontouchstart=e=>{this.actions.includes("rolling")||this.actions.push("rolling")},document.querySelector("#button-roll").ontouchend=e=>{this.actions.splice(this.actions.findIndex((e=>"rolling"==e)),1)},document.querySelector("#button-jump").ontouchstart=e=>{this.actions.includes("jumping")||this.actions.push("jumping")},document.querySelector("#button-jump").ontouchend=e=>{this.actions.splice(this.actions.findIndex((e=>"jumping"==e)),1)}}updateGamepad(){if(this.gamepad=navigator.getGamepads().find((e=>e?.connected)),this.gamepad&&this.gamepadSettings&&!(this.gamepadLastUpdate>=this.gamepad.timestamp)){if(this.gamepad.buttons.some((e=>e.pressed))&&(window.sound.initialized||window.sound.init(),document.fullscreenElement||window.setFullscreen()),this.gamepad.axes[this.gamepadSettings.YAxes]<=-.05?this.actions.includes("walking")||this.actions.push("walking"):this.actions.includes("walking")&&this.actions.splice(this.actions.findIndex((e=>"walking"==e)),1),this.gamepad.axes[this.gamepadSettings.YAxes]>=.5?this.actions.includes("walkingBack")||this.actions.push("walkingBack"):this.actions.includes("walkingBack")&&this.actions.splice(this.actions.findIndex((e=>"walkingBack"==e)),1),this.gamepad.axes[this.gamepadSettings.XAxes]<=-.05?this.actions.includes("turningLeft")||this.actions.push("turningLeft"):this.actions.includes("turningLeft")&&this.actions.splice(this.actions.findIndex((e=>"turningLeft"==e)),1),this.gamepad.axes[this.gamepadSettings.XAxes]>=.05?this.actions.includes("turningRight")||this.actions.push("turningRight"):this.actions.includes("turningRight")&&this.actions.splice(this.actions.findIndex((e=>"turningRight"==e)),1),this.gamepad.buttons[this.gamepadSettings.A].pressed)if(window.menuConfigOpened())window.executeMenuConfig();else{if(performance.now()<this.healLastUpdate)return;this.actions.includes("jumping")||this.actions.push("jumping"),this.healLastUpdate=performance.now()+250}else this.actions.includes("jumping")&&this.actions.splice(this.actions.findIndex((e=>"jumping"==e)),1);this.gamepad.buttons[this.gamepadSettings.B].pressed?document.querySelector("#dialog-controller").classList.contains("opened")?(document.querySelector("#dialog-controller").classList.remove("opened"),window.sound.playCancel()):window.menuConfigOpened()?window.toggleMenuConfig():this.actions.includes("rolling")||this.actions.push("rolling"):this.actions.includes("rolling")&&this.actions.splice(this.actions.findIndex((e=>"rolling"==e)),1),this.gamepad.buttons[this.gamepadSettings.X].pressed?this.actions.includes("backflip")||this.actions.push("backflip"):this.actions.includes("backflip")&&this.actions.splice(this.actions.findIndex((e=>"backflip"==e)),1),this.gamepad.buttons[this.gamepadSettings.Y].pressed?this.actions.includes("drinking")||this.actions.push("drinking"):this.actions.includes("drinking")&&this.actions.splice(this.actions.findIndex((e=>"drinking"==e)),1),this.gamepad.buttons[this.gamepadSettings.RB].pressed?this.actions.includes("slash")||this.actions.push("slash"):this.actions.includes("slash")&&this.actions.splice(this.actions.findIndex((e=>"slash"==e)),1),this.gamepad.buttons[this.gamepadSettings.LB].pressed?this.actions.includes("kick")||this.actions.push("kick"):this.actions.includes("kick")&&this.actions.splice(this.actions.findIndex((e=>"kick"==e)),1),this.gamepad.buttons[this.gamepadSettings.MENU].pressed&&window.game.togglePause(),this.gamepad.buttons[this.gamepadSettings.OPT].pressed&&window.toggleMenuConfig(!0),window.menuConfigOpened()&&(this.gamepad.buttons[this.gamepadSettings.UP]?.pressed&&window.navigateMenuConfig(-1),this.gamepad.buttons[this.gamepadSettings.DOWN]?.pressed&&window.navigateMenuConfig(1)),this.gamepadLastUpdate=this.gamepad.timestamp+100}}updateActions(){if(window.game.paused)return;let e=this.actions.includes("walking"),t=this.actions.includes("slash"),i=this.actions.includes("kick"),s=this.actions.includes("drinking"),n=this.actions.some((e=>["turningLeft","turningRight"].includes(e))),o=this.actions.includes("walkingBack"),a=this.actions.includes("backflip"),r=this.actions.includes("jumping"),c=this.actions.includes("rolling");if(this.actions.length<=0&&this.synchronizeCrossFade(this.animations.idle),!this.waitForAnimation&&s&&this.potions>0)this.isHealing=!0,this.waitForAnimation=!0,this.executeCrossFade(this.animations.drinking,.1,"once"),setTimeout((()=>{this.setupHeal()}),750*window.game.delay);else if(!this.waitForAnimation&&t){let e=.1;this.isSlashing=!0,this.waitForAnimation=!0,this.playAttackSE();let t="outwardSlash"==this.lastAction?.name?this.animations.inwardSlash:this.animations.outwardSlash;this.executeCrossFade(t,e,"once"),setTimeout((()=>this.executeMelleeAttack()),window.game.delay*(1e3*e*4/3))}else!this.waitForAnimation&&i?(this.isKicking=!0,this.waitForAnimation=!0,this.playAttackSE(),this.executeCrossFade(this.animations.kick,.1,"once")):this.waitForAnimation||!a||this.isBackingflip||(this.isBackingflip=!0,this.executeCrossFade(this.animations.backflip,.1,"once"),setTimeout((()=>{this.updateWalk(!1,!0,5)}),250*window.game.delay));if(!(this.waitForAnimation||this.isSlashing||this.isKicking||this.isBackingflip||(this.actions.includes("turningLeft")&&(this.object.rotation.y+=.025),this.actions.includes("turningRight")&&(this.object.rotation.y-=.025),e&&!this.isWalking?(this.isWalking=!0,this.executeCrossFade(this.animations.running)):!e&&this.isWalking&&(n||this.executeCrossFade(this.animations.idle),this.isWalking=!1,this.isRunning=!1),e&&this.updateWalk(!0),this.waitForAnimation||!c||this.isRolling||(this.isRolling=!0,this.executeCrossFade(this.animations.rolling,.25,"once")),this.isRolling||(this.waitForAnimation||!r||this.isJumping||(this.isJumping=!0,this.executeCrossFade(e?this.animations.jumpingRunning:this.animations.jumping,.25,"once")),e||this.isJumping)))){if(o&&!this.isSteppingBack?(this.isSteppingBack=!0,this.executeCrossFade(this.animations.walkingBack)):!o&&this.isSteppingBack&&(this.executeCrossFade(this.returnAction),this.isSteppingBack=!1),o)return this.updateWalk(!1,!0,.025);!this.isRotating&&n?(this.isRotating=!0,this.executeCrossFade(this.animations.walking)):this.isRotating&&!n&&(e||this.executeCrossFade(this.returnAction),this.isRotating=!1)}}updateWalk(e=!1,t=!1,i=.175){if(this.waitForAnimation)return;const s=Math.min(60*i/window.game.fps,i),n=this.camera.getWorldDirection(this.object.position.clone());t&&n.negate();const o=n.multiplyScalar(e?2.5*s:s),a=this.object.position.clone();a.add(o),a.x>=99||a.x<=-99||a.z>=99||a.z<=-99||this.object.position.add(o)}setupDamage(e){this.hp-=e,this.hp<0&&(this.hp=0),this.waitForAnimation=!0,this.beenHit=!0,this.refreshHPBar(),this.playDamageSE(),this.vibrate(),this.executeCrossFade(this.animations.stomachHit,.1,"once"),this.hp<=0&&!this.died&&(this.executeCrossFade(this.animations.dieing,1,"once"),window.sound.playME(window.sound.gameoverBuffer),this.died=!0)}setupHeal(){this.potions<=0||(this.potions--,this.playHealSE(),this.hp+=this.maxhp/2,this.hp>this.maxhp&&(this.hp=this.maxhp),this.refreshHPBar())}playAttackSE(){if(this.beenHit||this.sePlaying)return;const e=Object.keys(this.audios).filter((e=>e.startsWith("attack")));if(!e.length)return;let t=l(0,e.length-1);this.sePlaying=!0,window.sound.playSE(this.audios[e[t]],!1,this)}playSlashSE(){const e=Object.keys(this.audios).filter((e=>e.startsWith("slash")));if(!e.length)return;let t=l(0,e.length-1);window.sound.playSE(this.audios[e[t]],!1,this)}playDamageSE(){if(this.sePlaying)return;const e=Object.keys(this.audios).filter((e=>e.startsWith("damage")));if(!e.length)return;let t=l(0,e.length-1);this.sePlaying=!0,window.sound.playSE(this.audios[e[t]],!1,this)}playHealSE(){this.sePlaying=!0,window.sound.playSE(this.audios.heal,!1,this)}gameover(){document.querySelector("#game-over").classList.add("show"),document.querySelector("header").style.setProperty("display","none"),document.querySelectorAll("footer").forEach((e=>e.style.setProperty("display","none"))),window.game.gameover=!0}refreshHPBar(){let e=document.querySelector("#hpbar").clientWidth-4,t=Math.max(0,this.hp)*e/this.maxhp;document.querySelector("#hpbar").style.setProperty("--hp-width",`${t}px`),document.querySelector("#count-heal").innerHTML=this.potions}executeCrossFade(e,t=.25,i="repeat"){e&&(this.actions.some((e=>["walking","running","turningLeft","turningRight","walkingBack"].includes(e)))&&"idle"==e.name||super.executeCrossFade(e,t,i))}synchronizeCrossFade(e,t=.25,i="repeat"){this.mixer.addEventListener("loop",(function n(o){s.resetActions(),o.action==s.lastAction&&(s.mixer.removeEventListener("loop",n),s.executeCrossFade(e,t,i))}));const s=this}onFinishActions(){this.mixer.addEventListener("finished",(()=>{if(this.died)return this.gameover();this.actions.some((e=>["slash","kick","backflip"].includes(e)))||this.executeCrossFade(this.returnAction),this.resetActions()}))}resetActions(){this.waitForAnimation=!1,this.isBackingflip=!1,this.isRolling=!1,this.isJumping=!1,this.beenHit=!1,this.isSlashing=!1,this.isKicking=!1,this.isHealing=!1,this.processingAttack=!1}initAudio(){for(let e=0;e<=4;e++)this.fetchAudio(`attack-${e}`,`./audio/hero/attack/${e}.mp3`),this.fetchAudio(`damage-${e}`,`./audio/hero/damage/${e}.mp3`);for(let e=0;e<=3;e++)this.fetchAudio(`slash-${e}`,`./audio/weapons/slash-${e}.mp3`);this.fetchAudio("heal","./audio/misc/drinking.mp3")}vibrate(e=100,t=.1){if(this.gamepad)this.gamepad.vibrationActuator.playEffect(this.gamepad.vibrationActuator.type,{startDelay:0,duration:t,weakMagnitude:e/1e3,strongMagnitude:e/500});else if(s.isMobile)try{navigator.vibrate(e)}catch(e){}}toggleVisibility(){document.hidden&&this.actions.splice(0)}executeMelleeAttack(){if(!this.isSlashing)return;let e=this.hasHit(window.game.enemy);e&&Math.random()<=.75&&(window.game.enemy.setupDamage(10),this.playSlashSE()),this.processingAttack=!e}resizeScene(){this.refreshHPBar()}get returnAction(){return this.actions.some((e=>["walking","turningLeft","turningRight"].includes(e)))?this.animations.running:this.actions.includes("walkingBack")?this.animations.walkingBack:this.animations.idle}}const m=["aoMap","emissiveMap","displacementMap","map","normalMap","specularMap"],f=[],w=new a.dpR;if(window.sound=new class{constructor(){this.initialized=!1,this.audio=new Audio,this.audioContext=new AudioContext,this.bgmVolume=.25,this.seVolume=1,this.guiSEs=["cursor","click","cancel"],this.ses=[],this.load()}load(){fetch("./audio/bgm/bgm.mp3",{cache:"force-cache"}).then((e=>{e.arrayBuffer().then((e=>{this.audioContext.decodeAudioData(e).then((e=>{this.bgmBuffer=e,this.initialized&&this.playBGM()}))}))})),fetch("./audio/me/gameover.mp3",{cache:"force-cache"}).then((e=>{e.arrayBuffer().then((e=>{this.audioContext.decodeAudioData(e).then((e=>{this.gameoverBuffer=e}))}))})),this.guiSEs.forEach((e=>{fetch(`./audio/se/${e}.mp3`,{cache:"force-cache"}).then((t=>{t.arrayBuffer().then((t=>{this.audioContext.decodeAudioData(t).then((t=>{this.ses[e]=t}))}))}))}),this)}init(){if(this.initialized)return;this.bgmGain=this.audioContext.createGain(),this.bgmGain.gain.value=this.bgmVolume,this.seGain=this.audioContext.createGain(),this.seGain.gain.value=this.seVolume;const e=this.audioContext.createMediaStreamDestination();this.bgmGain.connect(this.audioContext.destination),this.seGain.connect(this.audioContext.destination),this.audio.srcObject=e.stream,this.audio.play(),this.audioListener=new a.SJI,this.audioListener.setMasterVolume(this.seVolume),window.game&&(window.game.camera.add(this.audioListener),window.game.initAudio()),this.playBGM(),this.initialized=!0}playBGM(e=!0){!window.game.gameover&&this.audioContext&&this.bgmBuffer&&(this.bgmSource=this.audioContext.createBufferSource(),this.bgmSource.buffer=this.bgmBuffer,this.bgmSource.loop=!0,this.bgmSource.connect(this.bgmGain),"false"!==localStorage.getItem("bgm")&&(e?this.bgmSource.start(0):this.bgmSource.start()),this.bgmSource.onended=()=>{this.bgmSource.disconnect(),this.bgmSource=void 0})}stopBGM(){try{this.bgmSource?.stop()}catch(e){}}playME(e){this.initialized&&e&&(this.stopBGM(),this.meSource=this.audioContext.createBufferSource(),this.meSource.buffer=e,this.meSource.connect(this.bgmGain),this.bgmGain.gain.value=this.seVolume,this.meSource.start(0),this.meSource.onended=()=>{this.bgmGain.gain.value=document.hidden?0:this.bgmVolume,this.meSource?.disconnect(),this.meSource=void 0,this.playBGM(!1)})}playSE(e,t=!1,i){if(!this.initialized||!this.audioContext||!e)return;const s=this.audioContext.createBufferSource();return s.buffer=e,s.loop=t,s.connect(this.seGain),s.start(0),s.onended=()=>{s.disconnect(),i&&(i.sePlaying=!1)},s}playClick(){this.playSE(this.ses.click)}playCursor(){this.playSE(this.ses.cursor)}playCancel(){this.playSE(this.ses.cancel)}toggleVisibility(){document.hidden?(this.bgmGain&&(this.bgmGain.gain.value=0),this.seGain&&(this.seGain.gain.value=0),this.audioListener?.setMasterVolume(0)):(this.bgmGain&&(this.bgmGain.gain.value=this.bgmVolume),this.seGain&&(this.seGain.gain.value=this.seVolume),this.audioListener?.setMasterVolume(this.seVolume))}},window.game=new class{loadingElements=3;constructor(){this.lastFrameTime=performance.now(),this.camera=new a.cPb(50,window.innerWidth/window.innerHeight,.1,1e3),this.clock=new a.SUY,this.ambientLight=new a.Mig(16777215,.1),this.dirLight=new a.Ox3(16777215,.1),this.textureLoader=new a.dpR,this.scene=new a.xsS,this.fps=0,this.fpsLimit=0,this.frames=0,this.clockDelta=0,this.initRender(),this.refreshFPS(),this.refreshResolution(),this.refreshPixelDensity(),this.setupLoading(),document.body.appendChild(this.renderer.domElement)}initRender(){this.renderer=new a.CP7({alpha:!0}),this.renderer.outputColorSpace=a.KI_,this.renderer.shadowMap.enabled=!0,this.dirLight.position.set(0,100,100),this.dirLight.castShadow=!0,this.scene.add(this.ambientLight),this.scene.add(this.dirLight),this.scene.background=null,this.refreshAntialiasing()}refreshFPS(e=!0){let t=localStorage.getItem("fpsLimit");"60"==t?this.fpsLimit=1/60:"30"==t?this.fpsLimit=1/30:(this.fpsLimit=0,t=0),e&&window.refreshFPS(t,!1)}refreshResolution(e=!0,t=!1){let i=localStorage.getItem("resolution");"1"==i?(this.screenWidth=parseInt(window.innerWidth/4*3),this.screenHeight=parseInt(window.innerHeight/4*3)):"2"==i?(this.screenWidth=parseInt(window.innerWidth/2),this.screenHeight=parseInt(window.innerHeight/2)):(i=0,this.screenWidth=window.innerWidth,this.screenHeight=window.innerHeight),e&&window.refreshResolution(i,!1),t&&setTimeout((()=>this.resizeScene()),10)}refreshPixelDensity(e=!0){let t=localStorage.getItem("pixelDensity");"0"==t?this.pixelDensity=window.devicePixelRatio:"1"==t?this.pixelDensity=window.devicePixelRatio/4*3:"2"==t?this.pixelDensity=window.devicePixelRatio/2:s.cpuCores>=4&&s.memory>=6?(this.pixelDensity=window.devicePixelRatio,t=0):s.cpuCores<4?(this.pixelDensity=window.devicePixelRatio/4*3,t=1):(this.pixelDensity=1,t=2),e&&window.refreshPixelDensity(t,!1)}refreshAntialiasing(e=!0){let t=localStorage.getItem("antialiasing");null==t&&s.cpuCores>=4&&(t="true"),this.renderer.antialias="true"==t,e&&window.window.refreshAntialiasing("true"==t,!1)}setupLoading(){const e=this;this.progress=new Proxy({},{set:function(t,i,n){t[i]=n;let o=Object.values(t).slice(),a=document.querySelector("progress"),r=o.reduce(((e,t)=>e+t),0);return r/=e.loadingElements,a&&(a.value=parseInt(r||0)),r>=100&&(s.isLocalhost?e.initGame():(a.style.setProperty("display","none"),s.isMobile&&(document.querySelector("#loading button").innerHTML="Começar"),document.querySelector("#loading button").style.removeProperty("display"))),!0}}),this.loadModels()}loadModels(){(e=>{if(e.textures)return e.textures.forEach((t=>{m.includes(t.type)&&f.push(new Promise(((i,s)=>{w.load(`./textures/${t.texture}`,(s=>{if(!s)throw"invalid texture";s.materialType=t.type,s.colorSpace=a.KI_,s.wrapS=a.rpg,s.wrapT=a.rpg,e?.repeat&&s.repeat.set(e.repeat,e.repeat),i(s)}),void 0,(e=>{s(e)}))})))})),new Promise(((t,i)=>{Promise.all(f).then((i=>{const s=new a.YBo;Object.entries(e).forEach((e=>{"normalScale"==e[0]?("object"==typeof e[1]&&(s[e[0]]=new a.FM8(e[1][0],e[1][1])),"number"==typeof e[1]&&(s[e[0]]=new a.FM8(e[1],e[1]))):s[e[0]]=e[1]})),i.forEach((e=>{s[e.materialType]=e})),t(s)})).catch((e=>{i(e)}))}))})({repeat:10,aoMapIntensity:3,emissiveIntensity:3,displacementScale:1.5,displacementBias:-.15,normalScale:10,textures:[{type:"aoMap",texture:"GroundForestRoots001_AO_1K.webp"},{type:"emissiveMap",texture:"GroundForestRoots001_GLOSS_1K.webp"},{type:"displacementMap",texture:"GroundForestRoots001_DISP_1K.webp"},{type:"map",texture:"GroundForestRoots001_COL_1K.webp"},{type:"normalMap",texture:"GroundForestRoots001_NRM_1K.webp"},{type:"specularMap",texture:"GroundForestRoots001_REFL_1K.webp"}]}).then((e=>{const t=new a.Kj0(new a._12(200,200,200,200),e);t.rotation.x=-Math.PI/2,t.receiveShadow=!0,this.scene.add(t),this.progress.ground||(this.progress.ground=100)})),this.player=new p(this.camera,(e=>{this.scene.add(e),this.dirLight.target=e}),(e=>{this.progress.player=e})),this.enemy=new u(this.player,(e=>{this.scene.add(e)}),(e=>{this.progress.enemy=e}))}initGame(){this.initiated||(this.resizeScene(),this.update(),setTimeout((()=>{s.isPC||document.querySelectorAll("footer").forEach((e=>e.style.removeProperty("display"))),document.querySelector("header").style.removeProperty("display"),document.body.removeChild(document.querySelector("#loading")),this.player.refreshHPBar()}),250),this.initiated=!0)}update(){this.animationFrameId=requestAnimationFrame((()=>this.update())),document.hidden||this.gameover||(this.clockDelta+=this.clock.getDelta(),this.fpsLimit&&this.clockDelta<this.fpsLimit||(this.renderer.render(this.scene,this.camera),this.player.update(this.clockDelta),this.paused||(this.updateFPSCounter(),this.enemy.update(this.clockDelta)),this.clockDelta=this.fpsLimit?this.clockDelta%this.fpsLimit:this.clockDelta%(1/Math.max(this.fps,30))))}initAudio(){this.player.initAudio(),this.enemy.initAudio()}updateFPSCounter(){if(this.frames++,!(performance.now()<this.lastFrameTime+1e3)){if(this.fps=Math.round(1e3*this.frames/(performance.now()-this.lastFrameTime)),!Number.isNaN(this.fps)){let e=document.querySelector("#fps").getContext("2d");e.font="bold 20px sans-serif",e.textAlign="end",e.textBaseline="middle",e.fillStyle="rgba(255,255,255,0.25)",e.clearRect(0,0,80,20),e.fillText(`${this.fps} FPS`,80,10)}this.lastFrameTime=performance.now(),this.frames=0}}resizeScene(){this.camera.updateProjectionMatrix(),this.renderer.setPixelRatio(this.pixelDensity),this.camera.aspect=this.screenWidth/this.screenHeight,this.renderer.setSize(this.screenWidth,this.screenHeight,!1),this.player.resizeScene(),this.enemy.resizeScene()}toggleVisibility(){this.player?.toggleVisibility(),this.enemy?.toggleVisibility()}togglePause(){this.paused=!this.paused,this.paused?document.querySelector("#glass").classList.add("opened"):document.querySelector("#glass").classList.remove("opened")}get delay(){return this.fpsLimit?100*this.fpsLimit:1}},window.debugging=location.search.includes("debug"),location.protocol.startsWith("https")){var y=!1;navigator.serviceWorker.register("service-worker.js").then((e=>{e.onupdatefound=()=>{console.info("SW update found."),y=!0},e.installing?console.info("SW installing..."):e.active&&y&&(console.info("SW updated. Reloading..."),location.reload())}))}}},i={};function s(e){var n=i[e];if(void 0!==n)return n.exports;var o=i[e]={exports:{}};return t[e](o,o.exports,s),o.exports}s.m=t,e=[],s.O=(t,i,n,o)=>{if(!i){var a=1/0;for(l=0;l<e.length;l++){for(var[i,n,o]=e[l],r=!0,c=0;c<i.length;c++)(!1&o||a>=o)&&Object.keys(s.O).every((e=>s.O[e](i[c])))?i.splice(c--,1):(r=!1,o<a&&(a=o));if(r){e.splice(l--,1);var h=n();void 0!==h&&(t=h)}}return t}o=o||0;for(var l=e.length;l>0&&e[l-1][2]>o;l--)e[l]=e[l-1];e[l]=[i,n,o]},s.d=(e,t)=>{for(var i in t)s.o(t,i)&&!s.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={179:0};s.O.j=t=>0===e[t];var t=(t,i)=>{var n,o,[a,r,c]=i,h=0;if(a.some((t=>0!==e[t]))){for(n in r)s.o(r,n)&&(s.m[n]=r[n]);if(c)var l=c(s)}for(t&&t(i);h<a.length;h++)o=a[h],s.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return s.O(l)},i=self.webpackChunkhero=self.webpackChunkhero||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))})();var n=s.O(void 0,[477,580,515,217,140],(()=>s(245)));n=s.O(n);